From 20cc3501c512d42d925003449cc65cf76f20b93f Mon Sep 17 00:00:00 2001
From: Conor Dooley <conor.dooley@microchip.com>
Date: Thu, 29 Jul 2021 11:45:57 +0100
Subject: [PATCH 26/93] riscv: icicle kit: add gpio support

---
 arch/riscv/boot/dts/microchip/microchip-mpfs.dtsi | 11 +++++++++++
 arch/riscv/configs/icicle_kit_defconfig           |  5 ++++-
 2 files changed, 15 insertions(+), 1 deletion(-)

diff --git a/arch/riscv/boot/dts/microchip/microchip-mpfs.dtsi b/arch/riscv/boot/dts/microchip/microchip-mpfs.dtsi
index a8ea50b24e9f..d3a684114272 100644
--- a/arch/riscv/boot/dts/microchip/microchip-mpfs.dtsi
+++ b/arch/riscv/boot/dts/microchip/microchip-mpfs.dtsi
@@ -369,5 +369,16 @@ i2c1: i2c@2010b000 {
 			clocks = <&clkcfg CLK_I2C1>;
 			status = "okay";
 		};
+		mssgpio: gpio@20122000 {
+			compatible = "microsemi,ms-pf-mss-gpio";
+			interrupt-parent = <&plic>;
+			interrupts = <13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44>;
+			gpio-controller;
+			clocks = <&clkcfg CLK_GPIO2>;
+			reg = <0x00 0x20122000 0x0 0x1000>;
+			reg-names = "control";
+			#gpio-cells = <2>;
+			status = "okay";
+		};
 	};
 };
diff --git a/arch/riscv/configs/icicle_kit_defconfig b/arch/riscv/configs/icicle_kit_defconfig
index 16d2410de568..8d72c4ab2238 100644
--- a/arch/riscv/configs/icicle_kit_defconfig
+++ b/arch/riscv/configs/icicle_kit_defconfig
@@ -70,7 +70,10 @@ CONFIG_HW_RANDOM_VIRTIO=y
 CONFIG_SPI=y
 CONFIG_SPI_SIFIVE=y
 CONFIG_GPIOLIB=y
-CONFIG_GPIO_SIFIVE=y
+CONFIG_GPIOLIB_IRQCHIP=y
+CONFIG_OF_GPIO=y
+CONFIG_GPIO_MPFS=y
+CONFIG_GPIO_MICROSEMI=y
 # CONFIG_PTP_1588_CLOCK is not set
 CONFIG_POWER_RESET=y
 CONFIG_DRM=y
-- 
2.30.2

