From cefdca811dc03de36b763ad78d5d6b921b569fa7 Mon Sep 17 00:00:00 2001
From: Conor Dooley <conor.dooley@microchip.com>
Date: Fri, 23 Jul 2021 11:13:28 +0100
Subject: [PATCH 49/93] riscv: icicle kit: add pac193x support

---
 .../boot/dts/microchip/microchip-mpfs.dtsi    | 26 +++++++++++++++++++
 arch/riscv/configs/icicle_kit_defconfig       | 13 +++++++++-
 2 files changed, 38 insertions(+), 1 deletion(-)

diff --git a/arch/riscv/boot/dts/microchip/microchip-mpfs.dtsi b/arch/riscv/boot/dts/microchip/microchip-mpfs.dtsi
index ba484ef75906..fb382835b845 100644
--- a/arch/riscv/boot/dts/microchip/microchip-mpfs.dtsi
+++ b/arch/riscv/boot/dts/microchip/microchip-mpfs.dtsi
@@ -428,6 +428,32 @@ i2c1: i2c@2010b000 {
 			clock-frequency = <100000>;
 			clocks = <&clkcfg CLK_I2C1>;
 			status = "okay";
+			pac193x: pac193x@10 {
+				compatible = "microchip,pac1934";
+				reg = <0x10>;
+				samp-rate = <64>;
+				status = "okay";
+				ch0: channel0 {
+					uohms-shunt-res = <10000>;
+					rail-name = "VDDREG";
+					channel_enabled;
+				};
+				ch1: channel1 {
+					uohms-shunt-res = <10000>;
+					rail-name = "VDDA25";
+					channel_enabled;
+				};
+				ch2: channel2 {
+					uohms-shunt-res = <10000>;
+					rail-name = "VDD25";
+					channel_enabled;
+				};
+				ch3: channel3 {
+					uohms-shunt-res = <10000>;
+					rail-name = "VDDA_REG";
+					channel_enabled;
+				};
+			};
 		};
 		mssgpio: gpio@20122000 {
 			compatible = "microsemi,ms-pf-mss-gpio";
diff --git a/arch/riscv/configs/icicle_kit_defconfig b/arch/riscv/configs/icicle_kit_defconfig
index 509e2bfe6076..949e92b87cfd 100644
--- a/arch/riscv/configs/icicle_kit_defconfig
+++ b/arch/riscv/configs/icicle_kit_defconfig
@@ -174,6 +174,7 @@ CONFIG_POLARFIRE_SOC_SYS_CTRL=y
 CONFIG_HW_RANDOM_POLARFIRE_SOC=y
 CONFIG_RTC_DRV_MPFS=y
 CONFIG_I2C_MICROCHIP=y
+CONFIG_PAC193X=y
 
 CONFIG_BLK_DEV_ZONED=y
 CONFIG_BLK_DEV_NVME=y
@@ -191,4 +192,14 @@ CONFIG_UIO_PDRV_GENIRQ=y
 CONFIG_UIO_DMEM_GENIRQ=y
 CONFIG_UIO_MICROCHIP_CAN=y
 CONFIG_UIO_MICROCHIP_PDMA=y
-CONFIG_UIO_MICROSEMI_DMA=y
\ No newline at end of file
+CONFIG_UIO_MICROSEMI_DMA=y
+
+CONFIG_IIO_BUFFER=y
+CONFIG_IIO_CONFIGFS=y
+CONFIG_IIO_CONSUMERS_PER_TRIGGER=2
+CONFIG_IIO_KFIFO_BUF=y
+CONFIG_IIO_SW_DEVICE=y
+CONFIG_IIO_SW_TRIGGER=y
+CONFIG_IIO_TRIGGERED_BUFFER=y
+CONFIG_IIO_TRIGGER=y
+CONFIG_IIO=y
\ No newline at end of file
-- 
2.30.2

